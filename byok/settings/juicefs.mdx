---
title: JuiceFS Shared Filesystem
---

JuiceFS enables shared filesystem (read-write-many) volume sets on BYOK clusters. The Control Plane platform automatically deploys the JuiceFS CSI driver and a Redis metadata server. You need to provide your own object storage bucket and credentials.

## Overview

When you deploy a BYOK location with JuiceFS enabled, the platform installs:

- **JuiceFS CSI Driver** - Handles volume provisioning and mounting
- **Redis Sentinel Cluster** - Stores filesystem metadata (deployed in the `juicefs` namespace)

You must provide:

- **Object Storage Bucket** - S3, GCS, Azure Blob, or S3-compatible storage (e.g., MinIO)
- **Storage Credentials** - Access keys for your object storage

## Prerequisites

Before configuring JuiceFS, ensure you have:

1. A BYOK location with JuiceFS enabled (default)
2. An object storage bucket accessible from your cluster
3. Credentials with read/write access to the bucket

## Configuration

Create a ConfigMap and Secret in the `juicefs` namespace to configure your object storage.

### ConfigMap

Create a ConfigMap named `juicefs` in the `juicefs` namespace:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: juicefs
  namespace: juicefs
data:
  storage: "s3"
  bucket: "https://your-bucket.s3.us-east-1.amazonaws.com"
  metadataUrl: "redis://juicefs-redis,juicefs-redis-sentinel-0.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-1.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-2.juicefs-redis-sentinel.juicefs:26379/1"
  secretName: "juicefs"
```

#### ConfigMap Fields

| Field | Required | Description |
|-------|----------|-------------|
| `storage` | Yes | Storage backend type: `s3`, `gs`, `wasb`, or `minio` |
| `bucket` | Yes | Full URL to your object storage bucket |
| `metadataUrl` | Yes | Redis URL for metadata (use the default value shown above) |
| `secretName` | Yes | Name of the Secret containing credentials |
| `gcsCredsSecretName` | GCS only | Name of Secret containing GCS service account JSON |
| `gcsCredsPath` | GCS only | Mount path for GCS credentials (default: `/root/.config/gcloud`) |
| `gcsCredsFileName` | GCS only | Filename for GCS credentials (default: `credentials.json`) |

### Secret

Create a Secret named `juicefs` in the `juicefs` namespace with your storage credentials:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: juicefs
  namespace: juicefs
type: Opaque
stringData:
  accessKey: "AKIAIOSFODNN7EXAMPLE"
  secretKey: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
```

<Note>
Using `stringData` lets you specify secret values in plaintextâ€”Kubernetes automatically base64-encodes them when storing the Secret. If you prefer to provide pre-encoded values, use `data` instead of `stringData`.
</Note>

## Storage Provider Examples

### AWS S3

```yaml
# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: juicefs
  namespace: juicefs
data:
  storage: "s3"
  bucket: "https://my-juicefs-bucket.s3.us-west-2.amazonaws.com"
  metadataUrl: "redis://juicefs-redis,juicefs-redis-sentinel-0.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-1.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-2.juicefs-redis-sentinel.juicefs:26379/1"
  secretName: "juicefs"
---
# Secret
apiVersion: v1
kind: Secret
metadata:
  name: juicefs
  namespace: juicefs
type: Opaque
stringData:
  accessKey: "AKIAIOSFODNN7EXAMPLE"
  secretKey: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
```

### Google Cloud Storage (GCS)

For GCS, use native authentication with a service account JSON file:

```yaml
# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: juicefs
  namespace: juicefs
data:
  storage: "gs"
  bucket: "gs://my-juicefs-bucket"
  metadataUrl: "redis://juicefs-redis,juicefs-redis-sentinel-0.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-1.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-2.juicefs-redis-sentinel.juicefs:26379/1"
  secretName: "juicefs"
  gcsCredsSecretName: "juicefs-gcs-creds"
  gcsCredsPath: "/root/.config/gcloud"
  gcsCredsFileName: "credentials.json"
---
# Empty main secret (required but not used for native GCS auth)
apiVersion: v1
kind: Secret
metadata:
  name: juicefs
  namespace: juicefs
type: Opaque
data: {}
---
# GCS credentials secret
apiVersion: v1
kind: Secret
metadata:
  name: juicefs-gcs-creds
  namespace: juicefs
type: Opaque
stringData:
  credentials.json: |
    {
      "type": "service_account",
      "project_id": "your-project",
      "private_key_id": "...",
      "private_key": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n",
      "client_email": "juicefs@your-project.iam.gserviceaccount.com",
      "client_id": "...",
      "auth_uri": "https://accounts.google.com/o/oauth2/auth",
      "token_uri": "https://oauth2.googleapis.com/token"
    }
```

### Azure Blob Storage

For Azure, the `accessKey` is your storage account name and `secretKey` is your storage account key:

```yaml
# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: juicefs
  namespace: juicefs
data:
  storage: "wasb"
  bucket: "https://mystorageaccount.blob.core.windows.net/my-container"
  metadataUrl: "redis://juicefs-redis,juicefs-redis-sentinel-0.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-1.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-2.juicefs-redis-sentinel.juicefs:26379/1"
  secretName: "juicefs"
---
# Secret
apiVersion: v1
kind: Secret
metadata:
  name: juicefs
  namespace: juicefs
type: Opaque
stringData:
  accessKey: "mystorageaccount"
  secretKey: "your-storage-account-key"
```

### MinIO or S3-Compatible Storage

```yaml
# ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: juicefs
  namespace: juicefs
data:
  storage: "minio"
  bucket: "http://minio.minio-namespace.svc:9000/juicefs-bucket"
  metadataUrl: "redis://juicefs-redis,juicefs-redis-sentinel-0.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-1.juicefs-redis-sentinel.juicefs,juicefs-redis-sentinel-2.juicefs-redis-sentinel.juicefs:26379/1"
  secretName: "juicefs"
---
# Secret
apiVersion: v1
kind: Secret
metadata:
  name: juicefs
  namespace: juicefs
type: Opaque
stringData:
  accessKey: "minioadmin"
  secretKey: "minioadmin"
```

## Verification

After creating the ConfigMap and Secret, verify JuiceFS is configured correctly:

1. Check the ConfigMap exists:
   ```bash
   kubectl get configmap juicefs -n juicefs -o yaml
   ```

2. Check the Secret exists:
   ```bash
   kubectl get secret juicefs -n juicefs
   ```

3. Verify the Redis cluster is running:
   ```bash
   kubectl get pods -n juicefs -l app=juicefs-redis
   ```

4. Create a test volume set with `fileSystemType: shared` to verify the complete setup.

## Troubleshooting

### Volume Set Creation Fails

If volume set creation fails, check the actuator logs for JuiceFS-related warnings:

```bash
kubectl logs -n controlplane deployment/actuator | grep juicefs
```

Common issues:

- **ConfigMap not found**: Ensure the ConfigMap is named `juicefs` and exists in the `juicefs` namespace
- **Missing secretName**: The ConfigMap must include the `secretName` field
- **Invalid credentials**: Verify your access key and secret key are correct
- **Bucket access denied**: Ensure your credentials have read/write access to the bucket

### Pods Stuck in ContainerCreating

If pods using JuiceFS volumes are stuck in `ContainerCreating`:

1. Check the JuiceFS CSI driver pods:
   ```bash
   kubectl get pods -n juicefs -l app=juicefs-csi-driver
   ```

2. Check CSI driver logs:
   ```bash
   kubectl logs -n juicefs -l app=juicefs-csi-driver -c juicefs-plugin
   ```

### Redis Connection Issues

If you see Redis connection errors:

1. Verify Redis Sentinel is running:
   ```bash
   kubectl get pods -n juicefs -l app=juicefs-redis-sentinel
   ```

2. Test Redis connectivity:
   ```bash
   kubectl exec -n juicefs juicefs-redis-0 -- redis-cli ping
   ```
