---
title: Kubernetes Cluster
---

## Kubernetes (k8s) Cluster

### Overview

Follow the steps below to install and configure an [agent](/reference/agent) within your k8s cluster.

### Prerequisites

- Review the [Agent](/reference/agent) reference page.
- Install the [CLI](/reference/cli).

### Step One - Create an Agent

Follow the [Create an Agent](/guides/agent) guide to define an agent and generate the bootstrap config file that will be used in
[step two](#step-two-launch-agent-within-a-k8s-cluster).

### Step Two - Launch agent within a K8s cluster

1. Open a new shell and execute the following command. Update tokens as necessary. Use the bootstrap file that was created in [step one](#step-one-create-an-agent-5).

```
cpln agent manifest --bootstrap-file bootstrap.json --namespace NAMESPACE --replicas 2 --cluster CLUSTER_ID > manifest.yaml

# inspect/modify the manifest file manually, if needed.
kubectl apply -f manifest.yaml
```

`cpln` will generate the manifest.yaml file that will deploy two replicas of the agent to the namespace of your choice (`NAMESPACE` in the example). The parameter `--cluster CLUSTER_ID` will be added to the agent's status which is used as a hint to know which cluster an agent has been deploy to.

It is recommended to use --replicas=2 for high availability (HA).

On startup, the agent will generate a public/private key-pair which is persisted as a k8s secret. In this scenario, the agents run under a k8s service account, which can create/modify secrets in its own namespace. If this is a concern, the agent can be configured to run in a dedicated namespace.

2. The agent will now be running, connecting to the Control Plane servers, and ready to process requests.

### Next Steps

Now that you have an agent configured and running, it can be used within an [identity](/reference/identity) to allow your [workload](/reference/workload) to connect to your local resources.