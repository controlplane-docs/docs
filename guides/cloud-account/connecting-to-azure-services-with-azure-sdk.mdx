- Cloud Account Creation
  - When registering a cloud account targeting Azure using the Azure SDK, an Azure Service Principal is created by your Azure administrator using the Azure CLI. The output of the Azure CLI command are credentials that are uploaded, stored securely, and assigned to the cloud account.
  - The name of this service principal is the name of your [org](/reference/org) prefixed with `cpln-` (i.e., cpln-ORG_NAME).
  - The only Azure API permission required by this principal is `Application.ReadWrite.OwnedBy` (which belongs to the Microsoft Graph API).
  - By granting this permission, the cloud account will be able to create/manage App registrations and query available Azure scopes and roles during the creation of an [identity](/reference/identity).

<Info>

The permissions `Application.ReadWrite.OwnedBy` "allows the app to create other applications, and fully manage those applications (read, update, update application secrets and delete), without a signed-in user. It cannot update any apps that it is not an owner of".

For every [identity](/reference/identity) created, Control Plane creates an App registration for which it generates short-lived credentials and injects them into your [workload](/concepts/workload) using the native cloud providers identity interface. No matter which cloud your workload is running, Control Plane ensures that the identity information is conveyed correctly to the consumed services. Control Plane mints tokens for the [identity](/reference/identity) bound to the workloads.

</Info>

- Identity Creation

  - When creating an [identity](/reference/identity), [cloud access](/reference/identity#cloud-access-universal-cloud-identity) rules targeting Azure can be defined which specify the minimum access needed by the identity. When the [identity](/reference/identity) is saved in the console, the Azure cloud account will leverage the service principal to create a new App registration with the configured access.
  - Any [workload](/concepts/workload) can be configured to use this [identity](/reference/identity) and will have access to the defined resources.

- Expired / Compromised Credentials

  - If the service principal credentials that were assigned to the cloud account expires or have been compromised, perform the following:

    - From the Azure portal:
      - Click `Azure Active Directory` and click `App registrations` in the left menu.
      - Click `All applications` and then click the app registration named `cpln-ORG_NAME`.
      - Click `Certificates & secrets` and then click `New client secret` and follow the wizard.
      - Copy the value of the new secret to the clipboard.
      - Delete the old secret.
    - From the Control Plane console:
      - Click `Secrets` in the left menu and select the `azure-sdk` secret that belongs to the cloud account (it will be named CLOUD_ACCOUNT_NAME-access).
      - Click the `Edit Data` button and then click the eye icon.
      - Update the `clientSecret` property with the value of the new secret by pasting it from the clipboard.

  - Until a valid secret value has been updated, Control Plane will not be able to manage workload [identities](/reference/identity).

