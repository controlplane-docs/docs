---
title: Manage Helm Releases
description: Deploy and manage Control Plane resources using Helm charts with the cpln helm command.
---

The `cpln helm` command lets you manage Control Plane resources using [Helm charts](https://helm.sh/docs/topics/charts/). Define your infrastructure as Helm templates and deploy them as versioned releases with full rollback support.

## When to use this

<CardGroup cols={2}>
  <Card title="Templated deployments" icon="code">
    Use Helm's templating engine for complex, parameterized configurations
  </Card>
  <Card title="Environment management" icon="layer-group">
    Deploy the same chart with different values for dev, staging, and production
  </Card>
  <Card title="Versioned releases" icon="clock-rotate-left">
    Track deployment history and rollback to previous versions
  </Card>
  <Card title="Helm ecosystem" icon="dharmachakra">
    Leverage existing Helm workflows and chart repositories
  </Card>
</CardGroup>

## Prerequisites

<AccordionGroup>
<Accordion title="CLI installed">
  Install the Control Plane CLI. See [Installation](/cli-reference/installation).
</Accordion>

<Accordion title="Helm installed">
  Install [Helm](https://helm.sh/docs/intro/install/) (v3 or later).
</Accordion>

<Accordion title="Required permissions">
  You need [policies](/reference/policy) to create the resources defined in your chart, plus `reveal` permission on secrets to manage release state.
</Accordion>
</AccordionGroup>

## Core concepts

### Releases

A **release** is a deployed instance of a Helm chart. Each release:
- Has a unique name within your organization
- Stores its state in an [opaque secret](/reference/secret#opaque)
- Tracks revisions for rollback (10 by default, configurable with [`--history-limit`](#manage-revision-history))
- Tags resources with `cpln/release` for tracking

### Release state

The release state tracks all resources deployed by the release, enabling:
- Detection of added, modified, or removed resources
- Automatic cleanup of deleted resources on upgrade
- Rollback to any previous revision

## Quick start

<Steps>
<Step title="Create a chart">
  Generate a new Helm chart:

  ```bash
  helm create my-chart
  ```
</Step>

<Step title="Define resources">
  Replace the contents of `my-chart/templates/` with Control Plane resources:

  ```yaml my-chart/templates/resources.yaml
  kind: gvc
  name: {{ .Values.gvc.name }}
  spec:
    staticPlacement:
      locationLinks:
        - //location/aws-eu-central-1
  ---
  kind: workload
  name: {{ .Values.workload.name }}
  gvc: {{ .Values.gvc.name }}
  spec:
    type: serverless
    containers:
      - name: main
        image: {{ .Values.workload.image }}
        ports:
          - number: 80
            protocol: http
  ```
</Step>

<Step title="Configure values">
  Update `my-chart/values.yaml`:

  ```yaml my-chart/values.yaml
  gvc:
    name: my-gvc

  workload:
    name: my-app
    image: nginx:latest
  ```
</Step>

<Step title="Install the release">
  Deploy the chart:

  ```bash
  cpln helm install my-release ./my-chart
  ```
</Step>
</Steps>

## Install a release

```bash
cpln helm install <release-name> <chart-path>
```

Install from different sources:

<Tabs>
<Tab title="Local chart">
  ```bash
  cpln helm install my-release ./my-chart
  ```
</Tab>

<Tab title="Helm repository">
  ```bash
  cpln helm install my-release postgres \
    --repo https://controlplane-com.github.io/helm-packages \
    --version 2.1.0
  ```
</Tab>

<Tab title="OCI registry">
  ```bash
  cpln helm install my-release \
    <oci-url> \
    --version <version>
  ```
</Tab>
</Tabs>

### Wait for readiness

Wait for workloads to become ready:

```bash
cpln helm install my-release ./my-chart --wait --timeout 600
```

## Upgrade a release

Update a release after modifying the chart:

```bash
cpln helm upgrade my-release ./my-chart
```

The CLI:
1. Renders the updated chart
2. Applies new and modified resources
3. Deletes resources removed from the chart
4. Updates the release state

<Warning>
Use the same release name to ensure proper tracking of resources.
</Warning>

## Manage revision history

By default, each release retains up to **10 revisions** for rollback. Use `--history-limit` on `upgrade` to adjust this:

```bash
# Keep 20 revisions
cpln helm upgrade my-release ./my-chart --history-limit 20

# Keep unlimited revisions
cpln helm upgrade my-release ./my-chart --history-limit 0
```

<Warning>
The `--history-limit` flag must be provided on **every upgrade**. If omitted, it resets to the default of 10 revisions. For consistent behavior, always include `--history-limit` in your upgrade commands or CI/CD pipelines.
</Warning>

| Value | Behavior |
|-------|----------|
| `10` (default) | Keeps the 10 most recent revisions |
| `0` | Keeps all revisions indefinitely |
| `N` | Keeps the N most recent revisions |

<Tip>
Setting `--history-limit 0` is useful for audit compliance or when you need the ability to rollback to any previous state.
</Tip>

## Rollback a release

Revert to a previous revision:

```bash
# Rollback to previous revision
cpln helm rollback my-release

# Rollback to specific revision
cpln helm rollback my-release 2
```

## View release information

<Tabs>
<Tab title="List releases">
  ```bash
  cpln helm list
  ```

  ```
  +------------+--------+---------+---------------+---------+--------+
  |NAME        |GVC     |REVISION |UPDATED        |STATUS   |CHART   |
  +------------+--------+---------+---------------+---------+--------+
  |my-release  |my-gvc  |3        |5 minutes ago  |deployed |my-chart|
  +------------+--------+---------+---------------+---------+--------+
  ```
</Tab>

<Tab title="Release history">
  ```bash
  cpln helm history my-release
  ```

  ```
  +---------+--------------+-----------+----------+----------------------+
  |REVISION |UPDATED       |STATUS     |CHART     |DESCRIPTION           |
  +---------+--------------+-----------+----------+----------------------+
  |1        |1 hour ago    |superseded |my-chart  |Install complete      |
  |2        |30 min ago    |superseded |my-chart  |Upgrade complete      |
  |3        |5 min ago     |deployed   |my-chart  |Upgrade complete      |
  +---------+--------------+-----------+----------+----------------------+
  ```
</Tab>

<Tab title="Get manifest">
  ```bash
  cpln helm get manifest my-release
  ```

  Shows the rendered YAML for the current release.
</Tab>

<Tab title="Get values">
  ```bash
  cpln helm get values my-release --all
  ```

  Shows merged chart and user values.
</Tab>
</Tabs>

## Uninstall a release

Remove all resources and delete the release:

```bash
cpln helm uninstall my-release
```

This deletes:
- All resources tracked by the release
- The release state secret

## Template preview

Preview the rendered output without deploying:

```bash
cpln helm template my-release ./my-chart
```

## Injected values

The CLI automatically injects these values into your chart:

| Key | Description |
|-----|-------------|
| `cpln.org` | Current organization name |
| `cpln.gvc` | Current GVC name |

Use in templates:

```yaml
gvc: {{ .Values.cpln.gvc }}
```

<Warning>
Avoid defining a top-level `cpln` key in your `values.yaml` as it will be overwritten.
</Warning>

## Protect resources from deletion

Prevent a resource from being deleted during upgrades or uninstalls:

```yaml
kind: volumeset
name: persistent-data
tags:
  helm.sh/resource-policy: keep
```

Resources with this tag are skipped during cleanup operations.

## Chart notes

Create `templates/NOTES.txt` to display messages after install/upgrade:

```
Release {{ .Release.Name }} deployed!
Access your app at: https://{{ .Values.workload.name }}.cpln.app
```

## Environment-specific values

Use different values files for each environment:

```bash
# Development
cpln helm install dev-release ./my-chart -f values-dev.yaml

# Production
cpln helm install prod-release ./my-chart -f values-prod.yaml
```

## Troubleshooting

<AccordionGroup>
<Accordion title="Release already exists">
  Use `upgrade` instead of `install` for existing releases:

  ```bash
  cpln helm upgrade my-release ./my-chart
  ```
</Accordion>

<Accordion title="Resources not deleted on upgrade">
  Ensure you're using the same release name. Resources are only tracked within a single release.
</Accordion>

<Accordion title="Rollback fails">
  Check available revisions with `cpln helm history`. By default, only 10 revisions are retained. See [Manage revision history](#manage-revision-history) to adjust this limit.
</Accordion>

<Accordion title="Permission denied on install">
  Ensure you have `reveal` permission on secrets to manage release state.
</Accordion>
</AccordionGroup>

## Next steps

<CardGroup cols={2}>
  <Card title="Apply YAML Manifests" href="/cli-reference/guides/cpln-apply" icon="file-code">
    Apply resources without Helm
  </Card>
  <Card title="CI/CD Usage" href="/cli-reference/ci-cd-development/ci-cd" icon="code">
    Automate Helm deployments
  </Card>
  <Card title="Workload Reference" href="/reference/workload/general" icon="book">
    Understand workload configuration
  </Card>
  <Card title="Helm Command Reference" href="/cli-reference/commands/helm" icon="book">
    Full helm command reference
  </Card>
</CardGroup>
